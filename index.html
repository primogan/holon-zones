
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>מערכת מיפוי חולון</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body, html { margin:0; padding:0; height:100%; font-family:Arial, sans-serif; }

/* ספלאש */
#splash {
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
height:100%;
background:#f0f0f0;
}
#splash h1 { margin-bottom:30px; }
.bubble {
width:140px; height:140px;
border-radius:50%;
background:#4CAF50;
color:white;
display:flex;
justify-content:center;
align-items:center;
margin:15px;
cursor:pointer;
font-weight:bold;
font-size:16px;
transition: transform 0.2s, background 0.3s;
box-shadow:0 4px 10px rgba(0,0,0,0.2);
}
.bubble:hover { transform:scale(1.1); background:#388E3C; }

/* מפות */
#mapContainer {
display:none;
height:100%;
width:100%;
position:relative;
}
#map {
height:100%;
width:100%;
}
#backBtn {
position:absolute;
top:10px;
left:10px;
z-index:1000;
background:#fff;
border:none;
padding:8px 12px;
cursor:pointer;
border-radius:6px;
font-weight:bold;
box-shadow:0 2px 6px rgba(0,0,0,0.2);
}
</style>
</head>
<body>
<!-- ספלאש -->
<div id="splash">
<h1>מערכת מיפוי אזורי גינון עירוני</h1>
<div class="bubble" onclick="openMap('zones')">אזורי פיקוח</div>
<div class="bubble" onclick="openMap('cases')">פניות גיזום</div>
</div>

<!-- מפת עבודה -->
<div id="mapContainer">
<button id="backBtn" onclick="goBack()">חזרה</button>
<div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map;
let currentLayer = null;

function initMap() {
map = L.map('map').setView([32.015, 34.78], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
maxZoom: 19
}).addTo(map);
}

function openMap(mode) {
document.getElementById("splash").style.display = "none";
document.getElementById("mapContainer").style.display = "block";

if (!map) { initMap(); }
setTimeout(() => { map.invalidateSize(); }, 300);

// נקה שכבות ישנות
if (currentLayer) {
map.removeLayer(currentLayer);
currentLayer = null;
}

if (mode === "zones") {
fetch("holon-zones.geojson")
.then(res => res.json())
.then(data => {
currentLayer = L.geoJSON(data, {
style: { color: "blue", weight: 2, fillOpacity: 0.2 },
onEachFeature: (feature, layer) => {
if (feature.properties && feature.properties.name) {
layer.bindPopup("אזור: " + feature.properties.name);
}
}
}).addTo(map);
map.fitBounds(currentLayer.getBounds());
})
.catch(err => alert("בעיה בטעינת קובץ holon-zones.geojson: " + err));
} else if (mode === "cases") {
fetch("cases.geojson")
.then(res => res.json())
.then(data => {
currentLayer = L.geoJSON(data, {
pointToLayer: (feature, latlng) => {
return L.marker(latlng, { title: feature.properties.address });
},
onEachFeature: (feature, layer) => {
let info = `<b>כתובת:</b> ${feature.properties.address || "לא צויין"}<br>
<b>תיאור:</b> ${feature.properties.description || "—"}<br>
<button onclick="closeCase(this)">טיפול הסתיים</button>`;
layer.bindPopup(info);
}
}).addTo(map);
map.fitBounds(currentLayer.getBounds());
})
.catch(err => alert("בעיה בטעינת קובץ cases.geojson: " + err));
}
}

function goBack() {
document.getElementById("mapContainer").style.display = "none";
document.getElementById("splash").style.display = "flex";
}

// סימון טיפול הסתיים
function closeCase(btn) {
let marker = btn.closest(".leaflet-popup")._source;
if (marker) {
marker.setIcon(new L.Icon.Default({ className: "finished" }));
marker.closePopup();
}
}
</script>
</body>
</html>
